<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigitalBzarr | Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        :root { --gold: #ffc107; --dark: #121212; }
        body { font-family: 'Arial', sans-serif; background: var(--dark); color: white; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 500px; margin: auto; }
        .card { background: #1e1e1e; border: 1px solid var(--gold); border-radius: 15px; padding: 25px; margin-top: 20px; }
        .btn { background: var(--gold); color: black; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1em; }
        #user-name { color: var(--gold); font-weight: bold; }
        .status-msg { font-size: 0.9em; margin-top: 10px; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>DigitalBzarr ğŸ›ï¸</h1>
    <div id="auth-section">
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ø²Ø§Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
        <button class="btn" id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Pi</button>
    </div>

    <div id="main-section" style="display: none;">
        <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ <span id="user-name"></span>!</p>
        <div class="card">
            <h3>Ù…Ù†ØªØ¬ Ø±Ù‚Ù…ÙŠ Ø­ØµØ±ÙŠ</h3>
            <p>Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶: 1.0 Ï€</p>
            <button class="btn" onclick="transferPi()">Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
            <div class="status-msg" id="payment-status"></div>
        </div>
    </div>
</div>

<script>
    const Pi = window.Pi;
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (ØªØ£ÙƒØ¯ Ø£Ù† sandbox: true Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
    Pi.init({ version: "2.0", sandbox: true });

    const loginBtn = document.getElementById('login-btn');
    
    loginBtn.onclick = async () => {
        try {
            // Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const auth = await Pi.authenticate(['username', 'payments'], (p) => {
                console.log("Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ø¬Ø§Ø±ÙŠØ©...");
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-section').style.display = 'block';
            document.getElementById('user-name').innerText = auth.user.username;
        } catch (err) {
            alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message);
        }
    };

    async function transferPi() {
        const status = document.getElementById('payment-status');
        status.innerText = "Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©...";
        
        try {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¯ÙØ¹ Ø±Ø³Ù…ÙŠ
            const payment = await Pi.createPayment({
                amount: 1.0,
                memo: "Ø´Ø±Ø§Ø¡ Ù…Ù†ØªØ¬ Ø±Ù‚Ù…ÙŠ Ù…Ù† DigitalBzarr",
                metadata: { itemId: "item_gold_01" },
            }, {
                onReadyForServerApproval: (paymentId) => {
                    status.innerText = "âœ… Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (ID: " + paymentId + ")";
                },
                onReadyForServerCompletion: (paymentId, txid) => {
                    status.innerText = "ğŸŠ Ù†Ø¬Ø­Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©! Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©: " + txid;
                    alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!");
                },
                onCancel: (paymentId) => { status.innerText = "âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"; },
                onError: (error) => { status.innerText = "âš ï¸ Ø®Ø·Ø£: " + error.message; }
            });
        } catch (e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ: " + e.message);
        }
    }
</script>

</body>
</html>
